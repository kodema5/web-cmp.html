var v=Object.defineProperty;var $=(t,e,r)=>e in t?v(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var C=(t,e)=>{for(var r in e)v(t,r,{get:e[r],enumerable:!0})};var O=(t,e,r)=>($(t,typeof e!="symbol"?e+"":e,r),r);var b=class{constructor(e,r){this.strings=e,this.keys=r,this.templateId="web-cmp-"+ ++b.templateId,this.template=null,this.dom=null,this.fnId=0,this.functions={}}get content(){return(this.template??this.build()).content}build(){let e=this,r=e.strings.map((s,o)=>{let i=e.keys[o];if(!i)return s;if(typeof i!="function")return[s,i];let l=this.getFnId();this.functions[l]=i;let a=i.call(e.context,e.context),u=a instanceof b?a.innerHTML:a;return[s,"<!--",l,"-->",u,"<!--\\",l,"-->"]}).flat().filter(Boolean).join(""),n=b.create(r);return this.template=n,n}getFnId(){return this.templateId+"-"+ ++this.fnId}get innerHTML(){let e=document.createElement("div");return e.appendChild(this.content.cloneNode(!0)),e.innerHTML}refresh(e=null,r){r=r??this.dom;let n=document.createTreeWalker(r,NodeFilter.SHOW_COMMENT);for(var s;s=n.nextNode();){let i=n.currentNode.textContent;if(!i)continue;let l=this.functions[i];if(!l)continue;let a=l.call(e,e),u=a instanceof b?a.content:a instanceof HTMLElement?a:b.create(a).content;if(!u)continue;let c="\\"+i;for(var o;(o=s.nextSibling)&&!(o.nodeType===8&&o.textContent===c);)o.remove();!s||s.parentNode.insertBefore(u,s.nextSibling)}}},m=b;O(m,"templateId",0),O(m,"create",e=>{let r=document.createElement("template");return r.innerHTML=e,r});var R=(t,...e)=>new m(t,e);var U=(t,{formAssociated:e=!0,elements:r={},connectedCallback:n=()=>{},attributes:s={},attributeChangedCallback:o=()=>{},properties:i={},...l}={})=>{let a=class extends HTMLElement{static formAssociated=e;constructor(){super(),this.template=t,this.internals=this.attachInternals();let c=this.attachShadow({mode:"open"});c.appendChild(t.content.cloneNode(!0)),W(this,c,r)}static get observedAttributes(){return Object.keys(s)}attributeChangedCallback(c,g,d){let y=s[c];y&&typeof y=="function"&&y.call(this,d,g),o.call(this,c,g,d)}refresh(){this.template.refresh(this,this.shadowRoot)}connectedCallback(){setTimeout(()=>{this.refresh(),n.call(this)})}},u=a.prototype;return _(u,i),_(u,l),a},W=(t,e,r)=>{Object.entries(r).reduce((n,[s,o])=>{let i=s==="."||s==="this"?[e]:e.querySelectorAll(s);return!i.length===0||i.forEach(l=>{let a=typeof o=="function"?o.call(t,l):{...o};n.set(l,Object.assign(n.get(l)||{},a))}),n},new Map).forEach((n,s)=>{let o=n.id||s.id;if(delete n.id,o&&s!==e){if(t[o])return;t[o]=s}Object.entries(n).forEach(([i,l])=>{let a=typeof l=="function";if(i[0]=="$"&&a){s.addEventListener(i.slice(1),l.bind(t));return}s[i]=a?l.bind(t):l})})},_=(t,e)=>{Object.getOwnPropertyNames(e).forEach(r=>{let n=Object.getOwnPropertyDescriptor(e,r);n.hasOwnProperty("value")?t[r]=n.value:("get"in n||"set"in n)&&Object.defineProperty(t,r,{get:n.get,set:n.set})})};var J=t=>{let{cssRules:e}=Array.from(document.styleSheets).filter(r=>r.href?.indexOf(t)>=0)[0]||{};return e?Object.values(e).map(r=>r.cssText).join(`
`):""};var S={toggleClass:(t,e)=>{let r=t.classList;r[r.contains(e)?"remove":"add"](e)}},q=Object.entries(S).reduce((t,[e,r])=>(t[e]=function(){let n=this.el;if(!n)throw new Error("element undefined");return r.apply(this,[n].concat(Array.from(arguments)))??this},t),{}),B=t=>Object.assign({...q},{el:t});Object.assign(B,S);var I={};C(I,{ajax:()=>f,ajaxFn:()=>X});var z=(t,e)=>{switch(e){case"any":return t;case"text":return t&&t.toString();case"json":return JSON.stringify(t)}throw new Error("unknown request data type")},K=(t,e)=>{switch(e){case"arrayBuffer":return t.arrayBuffer();case"blob":return t.blob();case"formData":return t.formData();case"json":return t.json();case"text":return t.text()}throw new Error("unknown response type")};function f({url:t,data:e,input:r=c=>c,output:n=c=>c,headers:s={},body:o,method:i="POST",timeout:l=0,requestType:a="json",responseType:u="json"}={}){if(!t)throw new Error("url required");t=t.indexOf("http")<0&&f.base_href?f.base_href+t:t,e=r(e);let c={method:i,headers:{...f.headers||{},...s}};!(i==="GET"||i==="HEAD")&&(c.body=o||z(e,a));let d=new AbortController;c.signal=d.signal;let y=new Promise(async(H,T)=>{let j;l&&(j=setTimeout(()=>{d.abort()},l)),c.signal.onabort=()=>{T(new Error("aborted"))};try{let p=await fetch(t,c);if(j&&clearTimeout(j),!p.ok)throw await p.body.cancel(),{[p.status]:p.statusText};let D=await K(p,u);H(await n(D))}catch(p){T(p)}});return y.abort=()=>d.abort(),y}f.base_href="";f.headers={"Content-Type":"application/json"};var G=t=>t!==null&&t instanceof Object&&t.constructor===Object,X=t=>async e=>{let r=await f({...t,data:{...t.data||{},...e}});if(G(r)){let{data:n,errors:s}=r;if(Boolean(n)^Boolean(s)){if(s)throw s;return n}}return r};var x=class{constructor({broadcastChannelId:e}){var r=this;if(r._id=0,r.channels={},e){let n=new BroadcastChannel(e);n.onmessage=s=>{let{channel:o,args:i}=s.data;r.publish_.apply(r,[o].concat(i))},r.broadcastChannel=n}}reset(){this._id=0,this.channels={}}channelId(e){let[r,...n]=(e||"").split(".");return[r,n.join(".")||`_${++this._id}`]}subscribe(e,r,n=!1){let[s,o]=this.channelId(e);if(!s)return;let i=this.channels;i[s]||(i[s]={});let l=i[s];if(l[o]&&!n)throw new Error(`subscribe: ${e} already exists`);return l[o]=r,[s,o].join(".")}unsubscribe(){let e=this;Array.from(arguments).flat().forEach(r=>{let[n,s]=e.channelId(r);if(!n)return;let o=e.channels[n];!o||delete o[s]})}publish_(e,...r){let n=this.channels[e];!n||Object.values(n).forEach(s=>{s.apply(null,r)})}publish(e,...r){let n=e.slice(-1)==="!";return e=n?e.slice(0,-1):e,n&&this.broadcastChannel&&this.broadcastChannel.postMessage({channel:e,args:r}),this.publish_.apply(this,[e].concat(r))}async exec(e,...r){let n=this.channels[e];if(!n)return;let s=Object.values(n).map(i=>i.apply(null,r)),o=await Promise.all(s);return Object.keys(n).reduce((i,l,a)=>(i[l]=o[a],i),{})}},Q=globalThis.WEB_PUBSUB_BROADCAST_CHANNEL_ID||"web-pubsub-broadcast-channel-id",h=new x({broadcastChannelId:Q}),ue=h.publish.bind(h),fe=h.subscribe.bind(h),he=h.unsubscribe.bind(h),pe=h.exec.bind(h);var k={};C(k,{proxy:()=>A,wrap:()=>Y,wrap_worker:()=>E});var Y=t=>{if(t instanceof Worker)return E(t);let e;if(typeof t=="function"?e=`(${A})(${t})`:t instanceof Object&&t.constructor===Object?e=`(${A})(${Z(t)})`:typeof t=="string"&&(e=t),!e)throw new Error("unsupported type");let r=new Blob([e],{type:"text/javascript"}),n=URL.createObjectURL(r),s=new Worker(n,"Deno"in globalThis?{type:"module"}:{});return E(s)},Z=t=>`{ ${Object.entries(t).map(([e,r])=>`${e}:${typeof r=="function"?r+"":JSON.stringify(r)}`).join(",")} }`,E=t=>{let e=0,r={},n=(...s)=>new Promise((o,i)=>{let l=++e;t.postMessage({id:l,args:s}),r[l]={ok:o,err:i}});return t.onmessage=s=>{if(!s)return;let{id:o,data:i,error:l}=s.data||{};if(!o)return;let a=r[o];if(!a)return;delete r[o];let{ok:u,err:c}=a;return l?c(l):u(i)},new Proxy(n,{get(s,o){return o==="__worker"?t:(...i)=>new Promise((l,a)=>{let u=++e;t.postMessage({id:u,fn:o,args:i}),r[u]={ok:l,err:a}})}})},A=(t,e=null)=>{let r={};if(typeof t=="function")r._=t;else if(t!==null&&t instanceof Object&&t.constructor===Object)r=t;else throw new Error("please pass function/object");globalThis.onmessage=function(n){if(!n)return;let{id:s,fn:o="_",args:i}=n.data||{};(async()=>{var l={id:s};try{if(!r.hasOwnProperty(o))throw new Error("undefined property");let a=r[o],u=typeof a=="function";l.data=u?await a.apply(e||r,i):a,!u&&i.length>0&&(r[o]=i[0])}catch(a){l.error=a}globalThis.postMessage(l)})()}};var P=(t,e,r)=>{let n=e.split("."),s=n.pop();var o=t||{};return n.forEach(i=>{o.hasOwnProperty(i)||(o[i]={}),o=o[i]}),o[s]=r,t},N=(t,e,r)=>{let n=e.split("."),s=t||{};for(let o of n){if(!s.hasOwnProperty(o))return r;s=s[o]}return s},M=(t,e)=>{let r=e.split("."),n=r.pop();var s=t||{};for(let o of r){if(!s.hasOwnProperty(o))return!1;s=s[o]}return delete s[n]},L=(t,e)=>{try{return JSON.parse(t)}catch{return e}};var w=class{constructor(e,r={}){if(!e)throw new Error("store id required");this.id=e,this.value=r}set(e,r){return this.value=P(this.value||{},e,r),this.save(),this}get(e,r){return this.value&&e?N(this.value,e,r):this.value}trim(e){return e?M(this.value,e):this.value={},this}save(){return globalThis.localStorage.setItem(this.id,JSON.stringify(this.value)),this}load(){let e=window.localStorage.getItem(this.id);return this.value=L(e)||{},this}reset(){return this.value={},globalThis.localStorage.removeItem(this.id),this}};var F=new w("web-cmp");F.load();var te="ajax.headers.Authorization";{let t=F.get(te,null);t&&(f.headers.Authorization=t)}export{I as Ajax,B as El,x as PubSub,w as Store,m as Template,J as getCssText,h as pubsub,F as store,R as template,k as waaf,U as webCmp};
//# sourceMappingURL=web-cmp.js.map
